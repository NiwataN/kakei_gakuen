<div class="container main">
  <div class="row">
    <div class="col-xs-12">
      <div id="PurchaseHistory" class="box">
        <div class="title">
          <h3>家計簿</h3>
          <hr width="300px">
        </div>

        <%
        #@books = Book.order(time: "DESC")
        timesHash = Hash.new
        @books.each do |book|
           if !timesHash.has_key?(book.time)
             timesHash[book.time] = [[book.item], [book.cost]]
           else
             timesHash[book.time][0].push(book.item)
             timesHash[book.time][1].push(book.cost)
           end
           previousTime = book.time
         end
        %>

        <div class="timeline">
          <dl>
            <%
            month = 0
            counter = 0
            timesHash.each{|key, value|
              #if counter == 10
              #  break
              #end
              if month != key.month
            %>
            <dt>
              <%= key.year.to_s + "年" + key.month.to_s + "月" %>
            </dt>
            <% end %>
            <dd class="pos-right clearfix">
						  <div class="circ"></div>
						  <div class="time">
                <%= key.month.to_s + "/" + key.day.to_s %>
              </div>
						  <div class="events">
							  <div class="events-body">
                  <table>
                    <% sum = 0 %>
                    <% @books.where(time: key).each do |book| %>
                    <tr>
                      <td class="purchase-left noto-demilight"><%= book.item %></td>
                      <td class="purchase-middle noto-demilight">:</td>
                      <td class="purchase-right noto-demilight"><%= book.cost %>円</td>
                      <% sum += book.cost %>
                    </tr>
                    <% end %>
                    <tr class="purchase-sum">
                      <th class="purchase-left noto-bold">合計</th>
                      <th class="purchase-middle noto-bold">:</th>
                      <th class="purchase-right noto-bold"><%= sum %>円</th>
                    </tr>
                  </table>
							  </div>
						  </div>
					  </dd>
            <% counter += 1
               month = key.month
               } %>
          </dl>
        </div>
      </div>
      <%= link_to 'もどる', user_path(@user.id) %>
    </div>
  </div>
</div>
